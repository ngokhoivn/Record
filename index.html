<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Speech to Text</title>
    <style>
        :root {
            --background-dark: #121212;
            --background-light: #1e1e1e;
            --text-color: #f5f5f5;
            --accent-color: #aa00ff;
            --danger-color: #d32f2f;
            --success-color: #388e3c;
            --info-color: #0288d1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-dark);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 10px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--accent-color);
        }

        h1 {
            margin: 0;
            color: var(--accent-color);
        }

        .status-bar {
            background-color: var(--background-light);
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .status-message {
            flex-grow: 1;
        }

        .status-bar.recording {
            background-color: rgba(170, 0, 255, 0.3);
            border-left: 4px solid var(--accent-color);
        }

        .status-bar.error {
            background-color: rgba(211, 47, 47, 0.3);
            border-left: 4px solid var(--danger-color);
        }

        .status-bar.ready {
            background-color: rgba(2, 136, 209, 0.3);
            border-left: 4px solid var(--info-color);
        }

        .status-bar.success {
            background-color: rgba(56, 142, 60, 0.3);
            border-left: 4px solid var(--success-color);
        }

        .language-tabs {
            display: flex;
            margin-bottom: 15px;
            border-radius: 5px;
            overflow: hidden;
            background-color: var(--background-light);
        }

        .language-tab {
            flex-grow: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border: none;
            background-color: var(--background-light);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .language-tab:hover {
            background-color: rgba(170, 0, 255, 0.3);
        }

        .language-tab.active {
            background-color: var(--accent-color);
            color: white;
        }

        .content-box {
            background-color: var(--background-light);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .content-box h3 {
            margin-top: 0;
            color: var(--accent-color);
            border-bottom: 1px solid rgba(170, 0, 255, 0.3);
            padding-bottom: 5px;
        }

        .result-box {
            min-height: 150px;
            white-space: pre-wrap;
        }

        .mic-button {
            display: block;
            width: 80px;
            height: 80px;
            margin: 20px auto;
            border-radius: 50%;
            background-color: var(--accent-color);
            color: white;
            font-size: 30px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .mic-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .mic-button.active {
            background-color: var(--danger-color);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(211, 47, 47, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(211, 47, 47, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(211, 47, 47, 0);
            }
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .action-button {
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            background-color: var(--background-light);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-button:hover {
            background-color: rgba(170, 0, 255, 0.3);
        }

        .clear-button {
            background-color: var(--danger-color);
        }

        .clear-button:hover {
            background-color: #b71c1c;
        }

        .copy-button {
            background-color: var(--info-color);
        }

        .copy-button:hover {
            background-color: #0277bd;
        }

        .copy-button.copied {
            background-color: var(--success-color);
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .mic-button {
                width: 70px;
                height: 70px;
                font-size: 26px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .mic-button {
                width: 60px;
                height: 60px;
                font-size: 22px;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .action-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Simple Speech to Text</h1>
            <p>Chuy·ªÉn ƒë·ªïi gi·ªçng n√≥i th√†nh vƒÉn b·∫£n ƒë∆°n gi·∫£n</p>
        </header>

        <div id="statusBar" class="status-bar ready">
            <span id="statusMessage" class="status-message">S·∫µn s√†ng</span>
        </div>

        <div class="language-tabs">
            <button id="langVi" class="language-tab active" onclick="changeLanguage('vi-VN')">üáªüá≥ Ti·∫øng Vi·ªát</button>
            <button id="langEn" class="language-tab" onclick="changeLanguage('en-US')">üá∫üá∏ Ti·∫øng Anh</button>
            <button id="langJa" class="language-tab" onclick="changeLanguage('ja-JP')">üáØüáµ Ti·∫øng Nh·∫≠t</button>
        </div>

        <div id="resultContainer" class="content-box">
            <h3>VƒÉn b·∫£n ƒë∆∞·ª£c nh·∫≠n d·∫°ng</h3>
            <div id="resultBox" class="result-box"></div>
        </div>

        <button id="micButton" class="mic-button" onclick="toggleRecognition()">üéôÔ∏è</button>

        <div class="action-buttons">
            <button id="copyButton" class="action-button copy-button" onclick="copyText()">Sao ch√©p</button>
            <button id="clearButton" class="action-button clear-button" onclick="clearText()">X√≥a</button>
        </div>
    </div>

    <script>
        // --- C√ÅC BI·∫æN TR·∫†NG TH√ÅI CH√çNH ---
        let isRecording = false;             // ƒêang ghi √¢m hay kh√¥ng
        let finalTranscript = '';            // K·∫øt qu·∫£ nh·∫≠n d·∫°ng cu·ªëi c√πng
        let interimTranscript = '';          // K·∫øt qu·∫£ t·∫°m th·ªùi trong qu√° tr√¨nh nh·∫≠n d·∫°ng
        let currentLang = 'vi-VN';           // Ng√¥n ng·ªØ hi·ªán t·∫°i
        let recognitionStoppedManually = false;  // Ki·ªÉm so√°t d·ª´ng th·ªß c√¥ng
        let recognition = null;              // ƒê·ªëi t∆∞·ª£ng nh·∫≠n d·∫°ng gi·ªçng n√≥i

        // --- QU·∫¢N L√ù DOM ELEMENTS ---
        const elements = {
            statusBar: document.getElementById('statusBar'),
            statusMessage: document.getElementById('statusMessage'),
            resultBox: document.getElementById('resultBox'),
            micButton: document.getElementById('micButton'),
            copyButton: document.getElementById('copyButton'),
            clearButton: document.getElementById('clearButton'),
            langTabs: {
                vi: document.getElementById('langVi'),
                en: document.getElementById('langEn'),
                ja: document.getElementById('langJa')
            }
        };

        // --- KH·ªûI T·∫†O NH·∫¨N D·∫†NG GI·ªåNG N√ìI ---
        function initSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showStatus('error', 'Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ nh·∫≠n di·ªán gi·ªçng n√≥i');
                return false;
            }

            try {
                // T·∫°o ƒë·ªëi t∆∞·ª£ng nh·∫≠n d·∫°ng
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();

                // C·∫•u h√¨nh
                recognition.lang = currentLang;
                recognition.interimResults = true;   // Cho ph√©p k·∫øt qu·∫£ t·∫°m th·ªùi
                recognition.continuous = true;       // Nh·∫≠n d·∫°ng li√™n t·ª•c
                recognition.maxAlternatives = 1;     // S·ªë l∆∞·ª£ng ph∆∞∆°ng √°n thay th·∫ø

                // X·ª≠ l√Ω c√°c s·ª± ki·ªán
                recognition.onresult = handleRecognitionResult;
                recognition.onstart = handleRecognitionStart;
                recognition.onend = handleRecognitionEnd;
                recognition.onerror = handleRecognitionError;

                return true;
            } catch (error) {
                console.error("L·ªói kh·ªüi t·∫°o nh·∫≠n d·∫°ng gi·ªçng n√≥i", error);
                showStatus('error', `L·ªói kh·ªüi t·∫°o: ${error.message}`);
                return false;
            }
        }

        // --- X·ª¨ L√ù K·∫æT QU·∫¢ NH·∫¨N D·∫†NG ---
        function handleRecognitionResult(event) {
            interimTranscript = '';
            
            for (let i = event.resultIndex; i < event.results.length; i++) {
                const transcript = event.results[i][0].transcript;
                
                if (event.results[i].isFinal) {
                    finalTranscript += transcript + ' ';
                } else {
                    interimTranscript += transcript;
                }
            }

            // Hi·ªÉn th·ªã k·∫øt qu·∫£
            displayTranscript();
        }

        function displayTranscript() {
            elements.resultBox.textContent = finalTranscript + interimTranscript;
        }

        // --- B·∫ÆT ƒê·∫¶U NH·∫¨N D·∫†NG ---
        function startRecognition() {
            try {
                if (!recognition) {
                    if (!initSpeechRecognition()) return;
                }

                // C·∫•u h√¨nh ng√¥n ng·ªØ hi·ªán t·∫°i
                recognition.lang = currentLang;

                // B·∫Øt ƒë·∫ßu ghi √¢m
                recognition.start();
                isRecording = true;
                recognitionStoppedManually = false;

                // C·∫≠p nh·∫≠t UI
                updateMicButtonState(true);
                showStatus('recording', 'ƒêang nghe... ');

            } catch (error) {
                console.error("L·ªói khi b·∫Øt ƒë·∫ßu nh·∫≠n d·∫°ng", error);
                showStatus('error', `Kh√¥ng th·ªÉ b·∫Øt ƒë·∫ßu ghi √¢m: ${error.message}`);
            }
        }

        // --- D·ª™NG NH·∫¨N D·∫†NG ---
        function stopRecognition() {
            try {
                recognitionStoppedManually = true;
                if (recognition) {
                    recognition.stop();
                }

                // C·∫≠p nh·∫≠t tr·∫°ng th√°i
                isRecording = false;

                // C·∫≠p nh·∫≠t UI
                updateMicButtonState(false);
                showStatus('ready', 'ƒê√£ d·ª´ng ghi √¢m');

                // Hi·ªÉn th·ªã k·∫øt qu·∫£ cu·ªëi c√πng (bao g·ªìm c·∫£ t·∫°m th·ªùi n·∫øu c√≥)
                if (interimTranscript.trim()) {
                    finalTranscript += interimTranscript.trim() + ' ';
                    elements.resultBox.textContent = finalTranscript.trim();
                    interimTranscript = '';
                }
            } catch (error) {
                console.error("L·ªói khi d·ª´ng nh·∫≠n d·∫°ng", error);
                showStatus('error', `L·ªói khi d·ª´ng ghi √¢m: ${error.message}`);
            }
        }

        // --- X·ª¨ L√ù KHI NH·∫¨N D·∫†NG K·∫æT TH√öC ---
        function handleRecognitionEnd() {
            isRecording = false;
            updateMicButtonState(false);

            // X·ª≠ l√Ω k·∫øt qu·∫£ t·∫°m th·ªùi c√≤n l·∫°i n·∫øu c√≥
            if (interimTranscript.trim()) {
                finalTranscript += interimTranscript.trim() + ' ';
                elements.resultBox.textContent = finalTranscript.trim();
                interimTranscript = '';
            }

            // T·ª± ƒë·ªông kh·ªüi ƒë·ªông l·∫°i n·∫øu kh√¥ng d·ª´ng th·ªß c√¥ng
            if (!recognitionStoppedManually) {
                try {
                    recognition.start();
                    isRecording = true;
                    updateMicButtonState(true);
                    showStatus('recording', 'ƒêang nghe...');
                } catch (e) {
                    console.error("L·ªói khi kh·ªüi ƒë·ªông l·∫°i", e);
                    showStatus('error', 'Kh√¥ng th·ªÉ ti·∫øp t·ª•c ghi √¢m');
                }
            } else {
                recognitionStoppedManually = false;  // ƒê·∫∑t l·∫°i c·ªù
            }
        }

        // --- X·ª¨ L√ù L·ªñI NH·∫¨N D·∫†NG ---
        function handleRecognitionError(event) {
            console.error("L·ªói nh·∫≠n d·∫°ng gi·ªçng n√≥i", event.error);

            let errorMessage = "L·ªói nh·∫≠n d·∫°ng gi·ªçng n√≥i";
            switch (event.error) {
                case 'no-speech':
                    errorMessage = "Kh√¥ng ph√°t hi·ªán gi·ªçng n√≥i";
                    break;
                case 'audio-capture':
                    errorMessage = "Kh√¥ng th·ªÉ truy c·∫≠p microphone";
                    break;
                case 'not-allowed':
                    errorMessage = "Quy·ªÅn truy c·∫≠p microphone b·ªã t·ª´ ch·ªëi";
                    break;
                case 'network':
                    errorMessage = "L·ªói k·∫øt n·ªëi m·∫°ng";
                    break;
                case 'aborted':
                    errorMessage = "Nh·∫≠n d·∫°ng b·ªã h·ªßy";
                    break;
                case 'language-not-supported':
                    errorMessage = "Ng√¥n ng·ªØ kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£";
                    break;
            }

            showStatus('error', errorMessage);
            isRecording = false;
            updateMicButtonState(false);
        }

        // --- X·ª¨ L√ù KHI B·∫ÆT ƒê·∫¶U NH·∫¨N D·∫†NG ---
        function handleRecognitionStart() {
            showStatus('recording', 'ƒêang nghe...');
            isRecording = true;
            updateMicButtonState(true);
        }

        // --- HI·ªÇN TH·ªä TR·∫†NG TH√ÅI ---
        function showStatus(type, message) {
            // Lo·∫°i b·ªè t·∫•t c·∫£ c√°c class tr·∫°ng th√°i hi·ªán t·∫°i
            elements.statusBar.classList.remove('recording', 'error', 'success', 'ready');

            // Th√™m class m·ªõi t∆∞∆°ng ·ª©ng v·ªõi lo·∫°i tr·∫°ng th√°i
            elements.statusBar.classList.add(type);

            // C·∫≠p nh·∫≠t n·ªôi dung
            elements.statusMessage.textContent = message;
        }

        // --- C·∫¨P NH·∫¨T TR·∫†NG TH√ÅI N√öT MIC ---
        function updateMicButtonState(isActive) {
            if (isActive) {
                elements.micButton.classList.add('active');
                elements.micButton.innerHTML = 'üõë';  // Icon d·ª´ng khi ƒëang ghi √¢m
                elements.micButton.title = 'D·ª´ng ghi √¢m';
            } else {
                elements.micButton.classList.remove('active');
                elements.micButton.innerHTML = 'üéôÔ∏è';  // Icon ghi √¢m khi kh√¥ng ho·∫°t ƒë·ªông
                elements.micButton.title = 'B·∫Øt ƒë·∫ßu ghi √¢m';
            }
        }

        // --- CHUY·ªÇN ƒê·ªîI GI·ªÆA B·∫ÆT ƒê·∫¶U V√Ä D·ª™NG NH·∫¨N D·∫†NG ---
        function toggleRecognition() {
            if (isRecording) {
                stopRecognition();
            } else {
                startRecognition();
            }
        }

        // --- THAY ƒê·ªîI NG√îN NG·ªÆ ---
        function changeLanguage(newLang) {
            currentLang = newLang;

            // C·∫≠p nh·∫≠t UI
            updateUILanguage(newLang);

            // C·∫≠p nh·∫≠t c·∫•u h√¨nh nh·∫≠n d·∫°ng gi·ªçng n√≥i
            if (recognition) {
                const wasRecording = isRecording;

                // D·ª´ng nh·∫≠n d·∫°ng hi·ªán t·∫°i
                if (wasRecording) {
                    stopRecognition();
                }

                // C·∫≠p nh·∫≠t ng√¥n ng·ªØ
                recognition.lang = newLang;

                // Kh·ªüi ƒë·ªông l·∫°i n·∫øu ƒëang ho·∫°t ƒë·ªông
                if (wasRecording) {
                    setTimeout(() => startRecognition(), 300);
                }
            }

            showStatus('ready', `ƒê√£ chuy·ªÉn ng√¥n ng·ªØ th√†nh ${getLanguageDisplayName(newLang)}`);
        }

        // --- T√äN HI·ªÇN TH·ªä CHO NG√îN NG·ªÆ ---
        function getLanguageDisplayName(langCode) {
            const names = {
                'vi-VN': 'Ti·∫øng Vi·ªát',
                'en-US': 'Ti·∫øng Anh',
                'ja-JP': 'Ti·∫øng Nh·∫≠t'
            };
            return names[langCode] || langCode;
        }

        // --- C·∫¨P NH·∫¨T UI THEO NG√îN NG·ªÆ ---
        function updateUILanguage(langCode) {
            // X√≥a tr·∫°ng th√°i active kh·ªèi t·∫•t c·∫£ c√°c tab
            for (const key in elements.langTabs) {
                elements.langTabs[key].classList.remove('active');
            }

            // ƒê·∫∑t tr·∫°ng th√°i active cho tab hi·ªán t·∫°i
            switch (langCode) {
                case 'vi-VN':
                    elements.langTabs.vi.classList.add('active');
                    break;
                case 'en-US':
                    elements.langTabs.en.classList.add('active');
                    break;
                case 'ja-JP':
                    elements.langTabs.ja.classList.add('active');
                    break;
            }
        }

        // --- SAO CH√âP VƒÇN B·∫¢N ---
        function copyText() {
            const text = elements.resultBox.textContent.trim();
            
            if (!text) {
                showStatus('error', 'Kh√¥ng c√≥ n·ªôi dung ƒë·ªÉ sao ch√©p');
                return;
            }
            
            try {
                navigator.clipboard.writeText(text).then(() => {
                    showStatus('success', 'ƒê√£ sao ch√©p vƒÉn b·∫£n v√†o clipboard');
                    
                    // Hi·ªáu ·ª©ng khi sao ch√©p th√†nh c√¥ng
                    elements.copyButton.textContent = '‚úì ƒê√£ sao ch√©p';
                    elements.copyButton.classList.add('copied');
                    
                    setTimeout(() => {
                        elements.copyButton.textContent = 'Sao ch√©p';
                        elements.copyButton.classList.remove('copied');
                    }, 2000);
                });
            } catch (error) {
                console.error("L·ªói khi sao ch√©p vƒÉn b·∫£n", error);
                showStatus('error', 'Kh√¥ng th·ªÉ sao ch√©p vƒÉn b·∫£n');
            }
        }

        // --- X√ìA VƒÇN B·∫¢N ---
        function clearText() {
            finalTranscript = '';
            interimTranscript = '';
            elements.resultBox.textContent = '';
            showStatus('ready', 'ƒê√£ x√≥a vƒÉn b·∫£n');
        }

        // --- KH·ªûI T·∫†O KHI TRANG ƒê∆Ø·ª¢C T·∫¢I ---
        document.addEventListener('DOMContentLoaded', () => {
            initSpeechRecognition();
            showStatus('ready', 'S·∫µn s√†ng nh·∫≠n d·∫°ng gi·ªçng n√≥i');
        });
    </script>
</body>
</html>
